{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard ‚Äî BlockShelf{% endblock %}

{% block content %}

<div class="d-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 m-0">
    üìä Dashboard
    <small class="text-muted ms-2">{{ owner_context.username }}</small>
  </h1>
  <a href="{% url 'inventory:list' %}" class="btn btn-outline-secondary">View Full Inventory</a>
</div>

<!-- Stats Cards -->
<div class="row g-3 mb-4">
  <div class="col-md-3">
    <div class="card">
      <div class="card-body text-center">
        <div class="text-muted small mb-1">Total Items</div>
        <div class="h2 mb-0 text-primary">{{ total_items }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body text-center">
        <div class="text-muted small mb-1">Total Quantity</div>
        <div class="h2 mb-0 text-success">{{ total_quantity }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body text-center">
        <div class="text-muted small mb-1">Parts Used</div>
        <div class="h2 mb-0 text-warning">{{ total_used }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card">
      <div class="card-body text-center">
        <div class="text-muted small mb-1">Available</div>
        <div class="h2 mb-0 text-info">{{ total_available }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Charts and Lists Row -->
<div class="row g-3 mb-4">
  <!-- Top Items by Quantity -->
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header">
        <h5 class="card-title mb-0">üèÜ Top Items by Quantity</h5>
      </div>
      <div class="card-body">
        {% if top_items %}
          <div class="list-group list-group-flush">
            {% for item in top_items %}
            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ item.name|truncatechars:40 }}</div>
                <small class="text-muted">{{ item.color }} ‚Ä¢ {{ item.part_id }}</small>
              </div>
              <span class="badge bg-primary rounded-pill">{{ item.quantity_total }}</span>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">No items yet. <a href="{% url 'inventory:add' %}">Add your first item</a>!</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Top Colors -->
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header">
        <h5 class="card-title mb-0">üé® Most Common Colors</h5>
      </div>
      <div class="card-body">
        {% if top_colors %}
          <div class="list-group list-group-flush">
            {% for item in top_colors %}
            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ item.color|title }}</div>
                <small class="text-muted">{{ item.count }} different item(s)</small>
              </div>
              <span class="badge bg-success rounded-pill">{{ item.total_qty }} total</span>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">No items yet.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Second Row -->
<div class="row g-3 mb-4">
  <!-- Most Used Items -->
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header">
        <h5 class="card-title mb-0">üî• Most Used Items</h5>
      </div>
      <div class="card-body">
        {% if most_used %}
          <div class="list-group list-group-flush">
            {% for item in most_used %}
            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ item.name|truncatechars:40 }}</div>
                <small class="text-muted">{{ item.color }} ‚Ä¢ {{ item.part_id }}</small>
              </div>
              <span class="badge bg-warning text-dark rounded-pill">{{ item.quantity_used }} used</span>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">No usage tracked yet.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Storage Locations -->
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header">
        <h5 class="card-title mb-0">üìç Storage Locations</h5>
      </div>
      <div class="card-body">
        {% if locations %}
          <div class="list-group list-group-flush">
            {% for loc in locations %}
            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ loc.storage_location }}</div>
              </div>
              <span class="badge bg-secondary rounded-pill">{{ loc.count }} item(s)</span>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">No storage locations set.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Third Row -->
<div class="row g-3">
  <!-- Low Stock Alert -->
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header">
        <h5 class="card-title mb-0">‚ö†Ô∏è Low Stock Alert</h5>
      </div>
      <div class="card-body">
        {% if low_stock %}
          <div class="list-group list-group-flush">
            {% for item in low_stock %}
            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ item.name|truncatechars:40 }}</div>
                <small class="text-muted">{{ item.color }} ‚Ä¢ {{ item.part_id }}</small>
              </div>
              <span class="badge bg-danger rounded-pill">{{ item.available }} left</span>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">All items have sufficient stock!</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Recent Additions -->
  <div class="col-lg-6">
    <div class="card h-100">
      <div class="card-header">
        <h5 class="card-title mb-0">üÜï Recent Additions</h5>
      </div>
      <div class="card-body">
        {% if recent_items %}
          <div class="list-group list-group-flush">
            {% for item in recent_items %}
            <div class="list-group-item d-flex justify-content-between align-items-center px-0">
              <div class="flex-grow-1">
                <div class="fw-medium">{{ item.name|truncatechars:40 }}</div>
                <small class="text-muted">{{ item.created_at|date:"M d, Y" }}</small>
              </div>
              <span class="badge bg-info rounded-pill">{{ item.quantity_total }}</span>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">No items yet. <a href="{% url 'inventory:add' %}">Add your first item</a>!</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <h6 class="card-title mb-3">Quick Actions</h6>
        <div class="d-flex gap-2 flex-wrap">
          <a href="{% url 'inventory:add' %}" class="btn btn-blockshelf-blue">‚ûï Add Item</a>
          <a href="{% url 'inventory:list' %}" class="btn btn-outline-secondary">üì¶ View All Items</a>
          <a href="{% url 'inventory:import_csv' %}" class="btn btn-outline-secondary">üì• Import</a>
          <a href="{% url 'inventory:export_csv' %}?owner={{ owner_context.id }}" class="btn btn-outline-secondary">üì§ Export</a>
          <a href="{% url 'inventory:settings' %}?tab=backups" class="btn btn-outline-secondary">üíæ Backups</a>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
